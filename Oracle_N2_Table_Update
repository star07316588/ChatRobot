CREATE OR REPLACE TRIGGER TRG_SINGLE_CONTROL_N2
  AFTER UPDATE ON FWADMIN.TBL_SINGLE_VALUE_CONTROL
  FOR EACH ROW
DECLARE
  v_error_no      NUMBER;
  v_error_message VARCHAR2(4000);
BEGIN
  IF :NEW.attribute = 'DOORKEEP' THEN
    BEGIN
      UPDATE tds.BA_DESCRIPTION_LIST@PRODTDS.MXIC.COM.TW
         SET DESCRIP = :NEW.value
       WHERE TAG = '209' AND ID = '0';
    EXCEPTION WHEN OTHERS THEN
      v_error_no      := SQLCODE;
      v_error_message := SQLERRM;
      INSERT INTO b2b.tbl_if_log_mes
        (ACTION, RULENAME, TABLENAME, KEYVALUE, MESSAGE, EXCEPTION, logtime)
      VALUES ('I','TRG_SINGLE_CONTROL_N2','TBL_SINGLE_VALUE_CONTROL',
              'tag=209, attribute='||:OLD.attribute,
              SUBSTR(v_error_no||','||v_error_message,1,512),
              'tag=209, attribute='||:OLD.attribute,
              SYSDATE);
      -- 不要 COMMIT；跟主交易一起
      RAISE;
    END;

  ELSIF :NEW.attribute = 'HUMILOW' THEN
    BEGIN
      UPDATE tds.BA_DESCRIPTION_LIST@PRODTDS.MXIC.COM.TW
         SET DESCRIP = :NEW.value
       WHERE TAG = '209' AND ID = '1';
    EXCEPTION WHEN OTHERS THEN
      v_error_no      := SQLCODE;
      v_error_message := SQLERRM;
      INSERT INTO b2b.tbl_if_log_mes
        (ACTION, RULENAME, TABLENAME, KEYVALUE, MESSAGE, EXCEPTION, logtime)
      VALUES ('I','TRG_SINGLE_CONTROL_N2','TBL_SINGLE_VALUE_CONTROL',
              'tag=209, attribute='||:OLD.attribute,
              SUBSTR(v_error_no||','||v_error_message,1,512),
              'tag=209, attribute='||:OLD.attribute,
              SYSDATE);
      -- 不要 COMMIT
      RAISE;
    END;
  END IF;
END TRG_SINGLE_CONTROL_N2;
/